{% extends "base.html" %}
{% block content %}

<div class="container-fluid">
  <h1 class="page-header">Staffing Simulator</h1>
  <form name="game" method="post" action="/{{generation}}">
    {% csrf-field %}
    <div class="row">
      <div class="col-sm-3">
        <div class="available_staff_table">
          <div class="staffing_plans_project_header">
            <h3>Available staff</h3>
          </div>

          {% safe %} {{people-table}} {% endsafe %}

        </div>
        <div class="counter"></div>
      </div>
      <div class="col-sm-9">
        <div class="staffing_plans_project">
          <div class="staffing_plans_project_header">
            <h3>Opportunity: <em>{{project.type}} ({{project.duration-weeks}} weeks)</em></h3>
          </div>
          <table class="project_table">
            <thead>
              <tr><th/>
                {% for dates in project.date-stream %}
                  <th class="staffing_plans_header_month"> {{dates.month}} </th>
                {% endfor %}
              </tr>
              <tr><th/>
                {% for dates in project.date-stream %}
                  <th> {{dates.start-of-week}} </th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
            {% for role in project.spots %}
              <tr class="staffing_plans_role">
                <td class="staffing_plans_role_cell open_role_background_{{role.role}}">
                  <!-- <div class="probability_label_default probability_label_{{role.role}}">100%</div> -->
                  <div><em>{{role.role}}</em><br />{{role.grade}}</div>
                </td>
                {% for week in project.lead-time %}
                  <td class="no_open_role"> </td>
                {% endfor %}
                {% for week in project.duration %}
                  <td class="staffing_plans_role_cell open_role_background_{{role.role}}"> </td>
                {% endfor %}

              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
        {% for old-project in old-projects %}
          <div class="old_staffing_plans_project">
            <div class="staffing_plans_project_header">
              <h3>Opportunity: <em>{{old-project.type}} ({{old-project.duration-weeks}} weeks)</em></h3>
            </div>
            <table class="project_table">
              <thead>
                <tr><th/>
                  {% for dates in old-project.date-stream %}
                    <th class="staffing_plans_header_month"> {{dates.month}} </th>
                  {% endfor %}
                </tr>
                <tr><th/>
                  {% for dates in old-project.date-stream %}
                    <th> {{dates.start-of-week}} </th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
              {% for role in old-project.spots %}
                <tr class="staffing_plans_role">
                  <td class="staffing_plans_role_cell open_role_background_{{role.role}}">
                    <!-- <div class="probability_label_default probability_label_{{role.role}}">100%</div> -->
                    <div><em>{{role.role}}</em><br />{{role.grade}}</div>
                  </td>
                  {% for week in old-project.lead-time %}
                    <td class="no_open_role"> </td>
                  {% endfor %}
                  {% for week in old-project.duration %}
                    <td class="staffing_plans_role_cell open_role_background_{{role.role}}"> </td>
                  {% endfor %}

                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% endfor %}
      </div>  
    </div>  
  </form>
</div>

{% endblock %}

{% block page-scripts %}

<script type="text/javascript">

// select/style a role row in the project table
$('.project_table > tbody > tr').click(function() {
    $(".project_table > tbody > tr").removeClass("project_role_selected_row");
    $(this).addClass("project_role_selected_row");
});

// consider/style a role row in the staffing table
$('.staffing_table > tbody > tr > td.staffing_plans_role_cell_count').hover(function() {
    $(".staffing_table > tbody > tr > td.staffing_plans_role_cell_count").removeClass("staffing_plans_considered_cell");
    $(".staffing_table > tbody > tr > td.staffing_plans_role_cell_count").removeClass("staffing_plans_selected_cell");
    $(this).addClass("staffing_plans_considered_cell");
});

// select/style a role row in the staffing table
$('.staffing_table > tbody > tr > td.staffing_plans_role_cell_count').click(function() {
    $(".staffing_table > tbody > tr > td.staffing_plans_role_cell_count").removeClass("staffing_plans_considered_cell");
    $(".staffing_table > tbody > tr > td.staffing_plans_role_cell_count").removeClass("staffing_plans_selected_cell");
    $(this).addClass("staffing_plans_selected_cell");
    var currentCount = $(this).text();
    if (currentCount > 0) {
      $(this).text(currentCount - 1);
    }
});

var clock = $('.counter').FlipClock(20, {
    clockFace: 'Counter'
  });

  setTimeout(function() {
    var interval = setInterval(function() {
      if(clock.getTime().time <= 0) {
        clock.reset();
        $('.staffing_plans_project').addClass('disabled')
        $(".project_table > tbody > tr").removeClass("staffing_plans_considered_cell");
        // document.game.submit();
      }     
      clock.decrement();
    }, 1000);
  });
</script>

{% endblock %}
