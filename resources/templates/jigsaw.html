{% extends "base.html" %}
{% block content %}

<div class="container-fluid">
  <h1 class="page-header">Staffing Simulator</h1>
  <form name="game" method="post" action="/{{generation}}">
    {% csrf-field %}
    <div class="row">
      <div class="col-sm-3">
        <div class="available_staff_table">
          <div class="staffing_plans_project_header">
            <h3>Available staff</h3>
          </div>

          {% safe %} {{people-table}} {% endsafe %}

        </div>
        <div class="counter"></div>
        <h3>Staffing Actions</h3>
        <div class="action_log_table">
          <ul id="action_log">
            <li>A record of each staffing action will appear here</li>
          </ul>
        </div>
      </div>
      <div class="col-sm-9">
        {% include "project-table.html" with main-style="staffing_plans_project" %}
        {{old-projects|count}}
        {% for project in old-projects %}
          {% include "project-table.html" with main-style="old_staffing_plans_project" %}
        {% endfor %}
      </div>  
    </div>  
  </form>
</div>

{% endblock %}

{% block page-scripts %}

<script type="text/javascript">

function logAction(actionText) {
  var actionLog = document.getElementById("action_log");
  var action = document.createElement("li");
  action.appendChild(document.createTextNode(actionText));
  actionLog.appendChild(action);
}

const STAFF_COUNT_CELL = ".staffing_table > tbody > tr > td.staffing_plans_role_cell_count";
const PROJECT_ROLE_ROW = ".staffing_plans_project > .project_table > tbody > tr";

$(PROJECT_ROLE_ROW).click(function() {
    $(PROJECT_ROLE_ROW).removeClass("project_role_selected_row");
    $(this).addClass("project_role_selected_row");
    logAction("Selected project role ''");
});

// select/style a role row in the staffing table
$(STAFF_COUNT_CELL).click(function() {
    $(STAFF_COUNT_CELL).removeClass("staffing_plans_selected_cell");
    $(this).addClass("staffing_plans_selected_cell");
    var currentCount = $(this).text();
    if (currentCount > 0) {
      $(this).text(currentCount - 1);
      logAction("Assigned " + $(this).attr('id') + " to '{{project.type}}'' - " + (currentCount - 1) + " remaining");
    }

});

var clock = $('.counter').FlipClock(20, {
    clockFace: 'Counter'
  });

  setTimeout(function() {
    var interval = setInterval(function() {
      if(clock.getTime().time <= 0) {
        clock.reset();
        // $('.staffing_plans_project').addClass('disabled')
        // document.game.submit();
      }     
      clock.decrement();
    }, 1000);
  });
</script>

{% endblock %}
